var __rest=this&&this.__rest||function(e,t){var i={};for(l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,l=Object.getOwnPropertySymbols(e);s<l.length;s++)t.indexOf(l[s])<0&&Object.prototype.propertyIsEnumerable.call(e,l[s])&&(i[l[s]]=e[l[s]]);return i};import{jsx as _jsx,jsxs as _jsxs}from"react/jsx-runtime";import React from"react";import"./style/index.css";import SplitUtils from"./utils/SplitUtils";import SplitSessionStorage from"./utils/SplitSessionStorage";import throttle from"lodash/throttle";import debounce from"lodash/debounce";import ManageHandleBar from"./helper/ManageHandleBar";import DragHandle from"./DragHandle/DragHandle";export default class Split extends React.Component{constructor(e){super(e),this.TOP="top",this.BOTTOM="bottom",this.LEFT="left",this.RIGHT="right",this.HORIZONTAL="horizontal",this.VERTICAL="vertical",this.state={dragging:!1},this.breaker=0,this.handleBarLayoutInfo={width:1,afterElementWidth:16,marginLeft:5,marginRight:5},this.onDraggingThrottled=throttle(this.onDragging.bind(this),16),this.onDragEndThrottled=throttle(this.onDragEnd.bind(this),16),this.saveHorizontalSizesToLocalStorageDebounced=debounce(SplitUtils.saveHorizontalSizesToLocalStorage.bind(SplitUtils),300),this.saveVerticalSizesToLocalStorageDebounced=debounce(SplitUtils.saveVerticalSizesToLocalStorage.bind(SplitUtils),300),this.userSession=new SplitSessionStorage,this.initDragging=!1,window.addEventListener("beforeunload",this.saveHorizontalSizesToLocalStorageDebounced),window.addEventListener("beforeunload",this.saveVerticalSizesToLocalStorageDebounced)}componentWillUnmount(){this.removeTouchEvent(),this.removeEvent()}componentDidMount(){var e=this.props["mode"];SplitUtils.setWrapper(this.warpper,e,this.props.enableSessionStorage),this.setInitialSizes()}checkTouchDevice(){return"ontouchstart"in window||0<navigator.maxTouchPoints}addTouchEvent(){this.checkTouchDevice()&&(window.addEventListener("touchmove",this.onDraggingThrottled,{passive:!1}),window.addEventListener("touchend",this.onDragEndThrottled,{passive:!1}))}removeTouchEvent(){this.checkTouchDevice()&&(window.removeEventListener("touchmove",this.onDraggingThrottled,!1),window.removeEventListener("touchcancel",this.onDragEndThrottled,!1))}removeEvent(){window.removeEventListener("mousemove",this.onDraggingThrottled,!1),window.removeEventListener("mouseup",this.onDragEndThrottled,!1),window.removeEventListener("beforeunload",this.saveHorizontalSizesToLocalStorageDebounced,!1),window.removeEventListener("beforeunload",this.saveVerticalSizesToLocalStorageDebounced,!1)}setInitialSizes(){var{mode:l,initialSizes:n}=this.props,r=null==(e=this.warpper)?void 0:e.children;if(r&&0<r.length){this.props.id&&SplitUtils.setSplitPaneInstance({[this.props.id]:this.warpper});var a=this.userSession.GetSession(l),o=(r.length+1)/2,e=Math.abs((r.length+1)/2-r.length),h=(this.handleBarLayoutInfo.marginLeft+this.handleBarLayoutInfo.marginRight+this.handleBarLayoutInfo.width)*e/o;let i=0,s=1;if(n&&0<n.length)for(let e=0;e<n.length;e++){var p,x=n[e],d=2*e;r.length>d&&(d=r[d],a&&0<a.length&&this.props.enableSessionStorage?"-1"===a[e].flexGrow?d.style.flexBasis=a[e].flexBasis:("0"===a[e].flexGrow&&d.classList.add("a-split-hidden"),d.style.flexBasis=a[e].flexBasis,d.style.flexGrow=a[e].flexGrow):(p=null==(p=d.parentElement)?void 0:p.getBoundingClientRect(),-1<h?x&&x.includes("%")?d.style.flexBasis=parseFloat(x)-SplitUtils.pixelToPercentage(h,`${l===this.HORIZONTAL?null==p?void 0:p.width:p.height}px`)+"%":d.style.flexBasis=parseFloat(x)-h+"px":d.style.flexBasis=""+x,0<i&&(d.style.flexGrow="1",i=0),this.props.collapsed[e]&&0===i&&(d.style.flexGrow="0",d.classList.add("a-split-hidden"),i++)),d.setAttribute("min-size",""+(this.props.minSizes[e]||0)),d.setAttribute("max-size",""+(this.props.maxSizes[e]||100)),ManageHandleBar.removeHandleIconOnClose(this.warpper,s++,SplitUtils.modeWrapper,SplitUtils.cachedMappedSplitPanePosition,l===this.HORIZONTAL?"horizontal":"vertical"))}if(n&&0===n.length){let t=0;for(let e=0;e<r.length;e+=2){var c=r[e],g=null==(g=c.parentElement)?void 0:g.getBoundingClientRect();c.style.flexBasis=`${l===this.HORIZONTAL?null==g?void 0:g.width:(null==g?void 0:g.height)/o-h}px`,c.setAttribute("min-size",""+(this.props.minSizes[t]||0)),c.setAttribute("max-size",""+(this.props.maxSizes[t]||100)),0<i&&(c.style.flexGrow="1",i=0),this.props.collapsed[t]&&0===i&&(c.style.flexGrow="0",c.classList.add("a-split-hidden"),i++),++t,ManageHandleBar.removeHandleIconOnClose(this.warpper,s++,SplitUtils.modeWrapper,SplitUtils.cachedMappedSplitPanePosition,l===this.HORIZONTAL?"horizontal":"vertical")}}let t=0;if(r&&0<r.length)for(let e=0;e<n.length;e++)SplitUtils.isSectionOpen(this.warpper,e+1,l)&&t++;1!==t||this.props.collapsed[0]||r[0]&&(r[0].style.flexGrow="1"),a&&0===a.length&&(l===this.HORIZONTAL?SplitUtils.saveHorizontalSizesToLocalStorage():SplitUtils.saveVerticalSizesToLocalStorage())}}setResizingLayout(i,s,l){l=String("horizontal"===l?this.props.width||(null==(l=null==i?void 0:i.parentElement)?void 0:l.getBoundingClientRect().width)||(null==(l=null==s?void 0:s.parentElement)?void 0:l.getBoundingClientRect().width):this.props.height||(null==(l=null==i?void 0:i.parentElement)?void 0:l.getBoundingClientRect().height)||(null==(l=null==s?void 0:s.parentElement)?void 0:l.getBoundingClientRect().height));if(this.prevToPrev&&this.prevToPrev.classList.contains("a-split-hidden")){let e=-1,t=!1;if(this.prevToPrev.style.flexBasis.includes("px")&&s.style.flexBasis.includes("%"))if(""===s.style.flexGrow){if(SplitUtils.percentageToPixel(this.nextSize,l)-parseFloat(this.prevToPrev.style.flexBasis)<0)return;i.style.flexBasis.includes("px")?i.style.flexBasis=SplitUtils.percentageToPixel(this.nextSize,l)-parseFloat(this.prevToPrev.style.flexBasis)+"px":i.style.flexBasis=this.nextSize-SplitUtils.pixelToPercentage(parseFloat(this.prevToPrev.style.flexBasis),l)+"%",s.style.flexBasis=this.preSize+"%"}else e=this.preSize-SplitUtils.pixelToPercentage(parseFloat(this.prevToPrev.style.flexBasis),l);else if(this.prevToPrev.style.flexBasis.includes("%")&&s.style.flexBasis.includes("px"))if(t=!0,""===s.style.flexGrow){if(SplitUtils.percentageToPixel(this.nextSize,l)-SplitUtils.percentageToPixel(parseFloat(this.prevToPrev.style.flexBasis),l)<0)return;i.style.flexBasis.includes("px")?i.style.flexBasis=SplitUtils.percentageToPixel(this.nextSize,l)-SplitUtils.percentageToPixel(parseFloat(this.prevToPrev.style.flexBasis),l)+"px":i.style.flexBasis=this.nextSize-parseFloat(this.prevToPrev.style.flexBasis)+"%",s.style.flexBasis=SplitUtils.percentageToPixel(this.preSize,l)+"px"}else e=SplitUtils.percentageToPixel(this.preSize,l)-SplitUtils.percentageToPixel(parseFloat(this.prevToPrev.style.flexBasis),l);else if(this.prevToPrev.style.flexBasis.includes("px")&&s.style.flexBasis.includes("px"))if(t=!0,""===s.style.flexGrow){if(SplitUtils.percentageToPixel(this.nextSize,l)-parseFloat(this.prevToPrev.style.flexBasis)<0)return;i.style.flexBasis.includes("px")?i.style.flexBasis=SplitUtils.percentageToPixel(this.nextSize,l)-parseFloat(this.prevToPrev.style.flexBasis)+"px":i.style.flexBasis=this.nextSize-SplitUtils.percentageToPixel(parseFloat(this.prevToPrev.style.flexBasis),l)+"%",s.style.flexBasis=SplitUtils.percentageToPixel(this.preSize,l)+"px"}else e=SplitUtils.percentageToPixel(this.preSize,l)-parseFloat(this.prevToPrev.style.flexBasis);else if(""===s.style.flexGrow){if(this.nextSize-parseFloat(this.prevToPrev.style.flexBasis)<0)return;i.style.flexBasis.includes("px")?i.style.flexBasis=SplitUtils.percentageToPixel(this.nextSize,l)-SplitUtils.percentageToPixel(parseFloat(this.prevToPrev.style.flexBasis),l)+"px":i.style.flexBasis=this.nextSize-parseFloat(this.prevToPrev.style.flexBasis)+"%",s.style.flexBasis=this.preSize+"%"}else e=this.preSize-parseFloat(this.prevToPrev.style.flexBasis);0<=e&&(s.style.flexBasis=""+e+(t?"px":"%"),i.style.flexBasis.includes("px")?i.style.flexBasis=SplitUtils.percentageToPixel(this.nextSize,l)+"px":i.style.flexBasis=this.nextSize+"%")}else if(this.nextToNext&&this.nextToNext.classList.contains("a-split-hidden")){let e=-1,t=!1;if(this.nextToNext.style.flexBasis.includes("px")&&i.style.flexBasis.includes("%"))if(""===i.style.flexGrow){if(SplitUtils.percentageToPixel(this.preSize,l)-parseFloat(this.nextToNext.style.flexBasis)<0)return;s.style.flexBasis.includes("px")?s.style.flexBasis=SplitUtils.percentageToPixel(this.preSize,l)-parseFloat(this.nextToNext.style.flexBasis)+"px":s.style.flexBasis=this.preSize-SplitUtils.pixelToPercentage(parseFloat(this.nextToNext.style.flexBasis),l)+"%",i.style.flexBasis=this.nextSize+"%"}else e=this.nextSize-SplitUtils.pixelToPercentage(parseFloat(this.nextToNext.style.flexBasis),l);else if(this.nextToNext.style.flexBasis.includes("%")&&i.style.flexBasis.includes("px"))if(t=!0,""===i.style.flexGrow){if(SplitUtils.percentageToPixel(this.preSize,l)-SplitUtils.percentageToPixel(parseFloat(this.nextToNext.style.flexBasis),l)<0)return;s.style.flexBasis.includes("px")?s.style.flexBasis=SplitUtils.percentageToPixel(this.preSize,l)-SplitUtils.percentageToPixel(parseFloat(this.nextToNext.style.flexBasis),l)+"px":s.style.flexBasis=this.preSize-parseFloat(this.nextToNext.style.flexBasis)+"%",i.style.flexBasis=SplitUtils.percentageToPixel(this.nextSize,l)+"px"}else e=SplitUtils.percentageToPixel(this.nextSize,l)-SplitUtils.percentageToPixel(parseFloat(this.nextToNext.style.flexBasis),l);else if(this.nextToNext.style.flexBasis.includes("px")&&i.style.flexBasis.includes("px"))if(t=!0,""===i.style.flexGrow){if(SplitUtils.percentageToPixel(this.preSize,l)-parseFloat(this.nextToNext.style.flexBasis)<0)return;s.style.flexBasis.includes("px")?s.style.flexBasis=SplitUtils.percentageToPixel(this.preSize,l)-parseFloat(this.nextToNext.style.flexBasis)+"px":s.style.flexBasis=this.preSize-SplitUtils.percentageToPixel(parseFloat(this.nextToNext.style.flexBasis),l)+"%",i.style.flexBasis=SplitUtils.percentageToPixel(this.nextSize,l)+"px"}else e=SplitUtils.percentageToPixel(this.nextSize,l)-parseFloat(this.nextToNext.style.flexBasis);else if(""===i.style.flexGrow){if(this.preSize-parseFloat(this.nextToNext.style.flexBasis)<0)return;s.style.flexBasis.includes("px")?s.style.flexBasis=SplitUtils.percentageToPixel(this.preSize,l)-SplitUtils.percentageToPixel(parseFloat(this.nextToNext.style.flexBasis),l)+"px":s.style.flexBasis=this.preSize-parseFloat(this.nextToNext.style.flexBasis)+"%",i.style.flexBasis=this.nextSize+"%"}else e=this.nextSize-parseFloat(this.nextToNext.style.flexBasis);0<=e&&(s.style.flexBasis.includes("px")?s.style.flexBasis=SplitUtils.percentageToPixel(this.preSize,l)+"px":s.style.flexBasis=this.preSize+"%",i.style.flexBasis=""+e+(t?"px":"%"))}else s.style.flexBasis.includes("px")?s.style.flexBasis=SplitUtils.percentageToPixel(this.preSize,l)+"px":s.style.flexBasis=this.preSize+"%",i.style.flexBasis.includes("px")?i.style.flexBasis=SplitUtils.percentageToPixel(this.nextSize,l)+"px":i.style.flexBasis=this.nextSize+"%"}onMouseDown(e,t){var i,s;t.target&&this.warpper&&(t.cancelable&&!this.checkTouchDevice()&&t.preventDefault(),s=("touches"in t?t.touches[0]:t).clientX,i=("touches"in t?t.touches[0]:t).clientY,this.paneNumber=e,this.startX=s,this.startY=i,this.move=!0,t.target.classList.contains("a-splitter-handlebar-icon")||t.target.classList.contains("a-splitter-collapse-icon")?this.target=t.target.parentElement:this.target=t.target,e=this.target.previousElementSibling,s=this.target.nextElementSibling,this.boxWidth=this.warpper.offsetWidth,this.boxHeight=this.warpper.offsetHeight,e&&(this.preWidth=e.offsetWidth,this.preHeight=e.offsetHeight),s&&(this.nextWidth=s.offsetWidth,this.nextHeight=s.offsetHeight),e&&e.previousElementSibling&&e.previousElementSibling.previousElementSibling&&(this.prevToPrev=e.previousElementSibling.previousElementSibling),s&&s.nextElementSibling&&s.nextElementSibling.nextElementSibling&&(this.nextToNext=s.nextElementSibling.nextElementSibling),this.addTouchEvent(),window.addEventListener("mouseup",this.onDragEndThrottled,!1),window.addEventListener("mousemove",this.onDraggingThrottled),this.setState({dragging:!0}))}onDragging(e){if(e.cancelable&&!this.checkTouchDevice()&&e.preventDefault(),this.move){this.state.dragging||this.setState({dragging:!0});const{mode:i,onDragging:s}=this.props,l=this.target.nextElementSibling,n=this.target.previousElementSibling;if(!l||!n||!l.classList.contains("a-split-hidden")&&!n.classList.contains("a-split-hidden")){var t=("touches"in e?e.touches[0]:e).clientX,e=("touches"in e?e.touches[0]:e).clientY;const r=t-this.startX,a=e-this.startY;this.preSize=0,this.nextSize=0;const o=()=>{if(i===this.HORIZONTAL){if(this.preSize=-1<this.preWidth+r?this.preWidth+r:0,this.nextSize=-1<this.nextWidth-r?this.nextWidth-r:0,0===this.preSize||0===this.nextSize)return;if(Math.abs(this.preSize-this.preWidth)<=1)return;if(Math.abs(this.nextSize-this.nextWidth)<=1)return;if(this.preSize=100*(1<=this.preSize/this.boxWidth?1:this.preSize/this.boxWidth),this.nextSize=100*(1<=this.nextSize/this.boxWidth?1:this.nextSize/this.boxWidth),n&&l){var e=n.getAttribute("min-size"),t=l.getAttribute("min-size");if(e&&this.preSize<=parseInt(e))return;if(t&&this.nextSize<=parseInt(t))return}if(n&&l){e=n.getAttribute("max-size"),t=l.getAttribute("max-size");if(e&&this.preSize>=parseInt(e))return;if(t&&this.nextSize>=parseInt(t))return}n&&l&&this.setResizingLayout(l,n,this.HORIZONTAL)}if(i===this.VERTICAL&&-1<this.preHeight+a&&-1<this.nextHeight-a){if(this.preSize=-1<this.preHeight+a?this.preHeight+a:0,this.nextSize=-1<this.nextHeight-a?this.nextHeight-a:0,this.preSize=100*(1<=this.preSize/this.boxHeight?1:this.preSize/this.boxHeight),this.nextSize=100*(1<=this.nextSize/this.boxHeight?1:this.nextSize/this.boxHeight),0===this.preSize||0===this.nextSize)return;if(Math.abs(this.preSize-this.preHeight)<=1)return;if(Math.abs(this.nextSize-this.nextHeight)<=1)return;if(n&&l){e=n.getAttribute("min-size"),t=l.getAttribute("min-size");if(e&&this.preSize<=parseInt(e))return;if(t&&this.nextSize<=parseInt(t))return}if(n&&l){e=n.getAttribute("max-size"),t=l.getAttribute("max-size");if(e&&this.preSize>=parseInt(e))return;if(t&&this.nextSize>=parseInt(t))return}n&&l&&this.setResizingLayout(l,n,this.VERTICAL)}this.initDragging=!0,s&&s(this.preSize,this.nextSize,this.paneNumber)};requestAnimationFrame(function(){o()}.bind(this))}}}onDragEnd(){var e=this.props["onDragEnd"];this.move=!1,e&&e(this.preSize,this.nextSize,this.paneNumber),this.removeTouchEvent(),this.removeEvent(),this.setState({dragging:!1}),this.props.enableSessionStorage&&this.initDragging&&(this.props.mode===this.HORIZONTAL?this.saveHorizontalSizesToLocalStorageDebounced():this.saveVerticalSizesToLocalStorageDebounced(),this.initDragging=!1)}render(){const e=this.props,{prefixCls:r,childPrefixCls:a,className:t,children:i,mode:s,visible:o=null!=(c=this.props.visible)?c:this.props.visiable,renderBar:h,lineBar:p,disable:x,fixClass:l,id:n}=e,d=__rest(e,["prefixCls","childPrefixCls","className","children","mode","visiable","visible","renderBar","lineBar","disable","onDragEnd","onDragging","fixClass","id"]);var c=this.state["dragging"],c=[r,t,r+"-"+s,c?"dragging":null,l?"a-split-pane-fix a-split-pane-helper-fix":null].filter(Boolean).join(" ").trim(),g=React.Children.toArray(i),{height:f,width:S}=d,u=__rest(d,["initialSizes","minSizes","maxSizes","enableSessionStorage","collapsed","height","width"]);return _jsx("div",Object.assign({className:c},u,{ref:e=>this.warpper=e,style:Object.assign({height:f||"",width:S||""},u.style),id:n},{children:React.Children.map(g,(e,t)=>{var i=Object.assign({},e.props,{className:[a,r+"-pane",e&&e.props&&"horizontal"!==e.props.mode&&"vertical"!==e.props.mode&&"a-split-scrollable",e.props.className].filter(Boolean).join(" ").trim(),style:Object.assign({},e.props.style)}),s=!0===o||o&&o.includes(t+1)||!1,l={className:[r+"-bar"].filter(Boolean).join(" ").trim()};0!==t&&(!0===p||p&&p.includes(t))&&(l.className=[l.className,p?r+"-line-bar":null].filter(Boolean).join(" ").trim()),0!==t&&(!0===x||x&&x.includes(t))&&(l.className=[l.className,x?"a-split-handle-disable":null].filter(Boolean).join(" ").trim());let n=null;return 0!==t&&s&&h?n=h(Object.assign(Object.assign({},l),{onMouseDown:this.onMouseDown.bind(this,t+1),onTouchStart:this.onMouseDown.bind(this,t+1)}),t):0!==t&&s&&(n=_jsx(DragHandle,{props:l,mode:this.props.mode,onMouseDown:this.onMouseDown.bind(this,t+1),onTouchStart:this.onMouseDown.bind(this,t+1),position:t},t)),_jsxs(React.Fragment,{children:[n,React.cloneElement(e&&e.props&&("horizontal"===e.props.mode||"vertical"===e.props.mode)?e:_jsx("div",{children:e}),Object.assign({},i))]},t)})}))}}Split.defaultProps={prefixCls:"a-split",childPrefixCls:"a-split-control-pane",visiable:!0,mode:"horizontal",initialSizes:[],minSizes:[],maxSizes:[],enableSessionStorage:!1,collapsed:[],height:null,width:null};